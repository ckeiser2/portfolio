!function(){function t(){this.initialize.apply(this,arguments)}function e(){this.initialize.apply(this,arguments)}function o(){this.initialize.apply(this,arguments)}var i=PluginManager.parameters("ItemBook"),a=String(i["Unknown Data"]||"??????"),s=String(i["Price Text"]||"Price"),r=String(i["Equip Text"]||"Equip"),n=String(i["Type Text"]||"Type"),p=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(e,o){if(p.call(this,e,o),"ItemBook"===e)switch(o[0]){case"open":SceneManager.push(t);break;case"add":$gameSystem.addToItemBook(o[1],Number(o[2]));break;case"remove":$gameSystem.removeFromItemBook(o[1],Number(o[2]));break;case"complete":$gameSystem.completeItemBook();break;case"clear":$gameSystem.clearItemBook()}},Game_System.prototype.addToItemBook=function(t,e){this._ItemBookFlags||this.clearItemBook();var o=this.itemBookTypeToIndex(t);o>=0&&(this._ItemBookFlags[o][e]=!0)},Game_System.prototype.removeFromItemBook=function(t,e){if(this._ItemBookFlags){var o=this.itemBookTypeToIndex(t);o>=0&&(this._ItemBookFlags[o][e]=!1)}},Game_System.prototype.itemBookTypeToIndex=function(t){switch(t){case"item":return 0;case"weapon":return 1;case"armor":return 2;default:return-1}},Game_System.prototype.completeItemBook=function(){var t;for(this.clearItemBook(),t=1;t<$dataItems.length;t++)this._ItemBookFlags[0][t]=!0;for(t=1;t<$dataWeapons.length;t++)this._ItemBookFlags[1][t]=!0;for(t=1;t<$dataArmors.length;t++)this._ItemBookFlags[2][t]=!0},Game_System.prototype.clearItemBook=function(){this._ItemBookFlags=[[],[],[]]},Game_System.prototype.isInItemBook=function(t){if(this._ItemBookFlags&&t){var e=-1;return DataManager.isItem(t)?e=0:DataManager.isWeapon(t)?e=1:DataManager.isArmor(t)&&(e=2),e>=0&&!!this._ItemBookFlags[e][t.id]}return!1};var h=Game_Party.prototype.gainItem;Game_Party.prototype.gainItem=function(t,e,o){var i;(h.call(this,t,e,o),t&&e>0)&&(DataManager.isItem(t)?i="item":DataManager.isWeapon(t)?i="weapon":DataManager.isArmor(t)&&(i="armor"),$gameSystem.addToItemBook(i,t.id))},t.prototype=Object.create(Scene_MenuBase.prototype),t.prototype.constructor=t,t.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},t.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this._indexWindow=new e(0,0),this._indexWindow.setHandler("cancel",this.popScene.bind(this));var t=this._indexWindow.height,i=Graphics.boxWidth,a=Graphics.boxHeight-t;this._statusWindow=new o(0,t,i,a),this.addWindow(this._indexWindow),this.addWindow(this._statusWindow),this._indexWindow.setStatusWindow(this._statusWindow)},e.prototype=Object.create(Window_Selectable.prototype),e.prototype.constructor=e,e.lastTopRow=0,e.lastIndex=0,e.prototype.initialize=function(t,o){var i=Graphics.boxWidth,a=this.fittingHeight(6);Window_Selectable.prototype.initialize.call(this,t,o,i,a),this.refresh(),this.setTopRow(e.lastTopRow),this.select(e.lastIndex),this.activate()},e.prototype.maxCols=function(){return 3},e.prototype.maxItems=function(){return this._list?this._list.length:0},e.prototype.setStatusWindow=function(t){this._statusWindow=t,this.updateStatus()},e.prototype.update=function(){Window_Selectable.prototype.update.call(this),this.updateStatus()},e.prototype.updateStatus=function(){if(this._statusWindow){var t=this._list[this.index()];this._statusWindow.setItem(t)}},e.prototype.refresh=function(){var t,e;for(this._list=[],t=1;t<$dataItems.length;t++)(e=$dataItems[t]).name&&1===e.itypeId&&"no"!==e.meta.book&&this._list.push(e);for(t=1;t<$dataWeapons.length;t++)(e=$dataWeapons[t]).name&&"no"!==e.meta.book&&this._list.push(e);for(t=1;t<$dataArmors.length;t++)(e=$dataArmors[t]).name&&"no"!==e.meta.book&&this._list.push(e);this.createContents(),this.drawAllItems()},e.prototype.drawItem=function(t){var e=this._list[t],o=this.itemRect(t),i=o.width-this.textPadding();if($gameSystem.isInItemBook(e))this.drawItemName(e,o.x,o.y,i);else{var s=Window_Base._iconWidth+4;this.drawText(a,o.x+s,o.y,i-s)}},e.prototype.processCancel=function(){Window_Selectable.prototype.processCancel.call(this),e.lastTopRow=this.topRow(),e.lastIndex=this.index()},o.prototype=Object.create(Window_Base.prototype),o.prototype.constructor=o,o.prototype.initialize=function(t,e,o,i){Window_Base.prototype.initialize.call(this,t,e,o,i)},o.prototype.setItem=function(t){this._item!==t&&(this._item=t,this.refresh())},o.prototype.refresh=function(){var t=this._item,e=0,o=0,i=this.lineHeight();if(this.contents.clear(),t&&$gameSystem.isInItemBook(t)){this.drawItemName(t,e,o),e=this.textPadding(),o=i+this.textPadding();var a=t.price>0?t.price:"-";if(this.changeTextColor(this.systemColor()),this.drawText(s,e,o,120),this.resetTextColor(),this.drawText(a,e+120,o,120,"right"),o+=i,DataManager.isWeapon(t)||DataManager.isArmor(t)){var p,h=$dataSystem.equipTypes[t.etypeId];this.changeTextColor(this.systemColor()),this.drawText(r,e,o,120),this.resetTextColor(),this.drawText(h,e+120,o,120,"right"),o+=i,p=DataManager.isWeapon(t)?$dataSystem.weaponTypes[t.wtypeId]:$dataSystem.armorTypes[t.atypeId],this.changeTextColor(this.systemColor()),this.drawText(n,e,o,120),this.resetTextColor(),this.drawText(p,e+120,o,120,"right"),e=this.textPadding()+300,o=i+this.textPadding();for(var m=2;m<8;m++)this.changeTextColor(this.systemColor()),this.drawText(TextManager.param(m),e,o,160),this.resetTextColor(),this.drawText(t.params[m],e+160,o,60,"right"),o+=i}e=0,o=2*this.textPadding()+7*i,this.drawTextEx(t.description,e,o)}}}();