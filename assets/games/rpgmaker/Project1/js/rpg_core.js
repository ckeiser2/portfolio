function JsExtensions(){throw new Error("This is not a class")}function Utils(){throw new Error("This is a static class")}function CacheEntry(t,e,i){this.cache=t,this.key=e,this.item=i,this.cached=!1,this.touchTicks=0,this.touchSeconds=0,this.ttlTicks=0,this.ttlSeconds=0,this.freedByTTL=!1}function CacheMap(t){this.manager=t,this._inner={},this._lastRemovedEntries={},this.updateTicks=0,this.lastCheckTTL=0,this.delayCheckTTL=100,this.updateSeconds=Date.now()}function ImageCache(){this.initialize.apply(this,arguments)}function RequestQueue(){this.initialize.apply(this,arguments)}function Point(){this.initialize.apply(this,arguments)}function Rectangle(){this.initialize.apply(this,arguments)}function Bitmap(){this.initialize.apply(this,arguments)}function Graphics(){throw new Error("This is a static class")}function Input(){throw new Error("This is a static class")}function TouchInput(){throw new Error("This is a static class")}function Sprite(){this.initialize.apply(this,arguments)}function Tilemap(){this.initialize.apply(this,arguments)}function ShaderTilemap(){Tilemap.apply(this,arguments),this.roundPixels=!0}function TilingSprite(){this.initialize.apply(this,arguments)}function ScreenSprite(){this.initialize.apply(this,arguments)}function Window(){this.initialize.apply(this,arguments)}function WindowLayer(){this.initialize.apply(this,arguments)}function Weather(){this.initialize.apply(this,arguments)}function ToneFilter(){PIXI.filters.ColorMatrixFilter.call(this)}function ToneSprite(){this.initialize.apply(this,arguments)}function Stage(){this.initialize.apply(this,arguments)}function WebAudio(){this.initialize.apply(this,arguments)}function Html5Audio(){throw new Error("This is a static class")}function JsonEx(){throw new Error("This is a static class")}function Decrypter(){throw new Error("This is a static class")}function ResourceHandler(){throw new Error("This is a static class")}Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.mod=function(t){return(this%t+t)%t},String.prototype.format=function(){var t=arguments;return this.replace(/%([0-9]+)/g,function(e,i){return t[Number(i)-1]})},String.prototype.padZero=function(t){for(var e=this;e.length<t;)e="0"+e;return e},Number.prototype.padZero=function(t){return String(this).padZero(t)},Object.defineProperties(Array.prototype,{equals:{enumerable:!1,value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.length;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0}},clone:{enumerable:!1,value:function(){return this.slice(0)}},contains:{enumerable:!1,value:function(t){return this.indexOf(t)>=0}}}),String.prototype.contains=function(t){return this.indexOf(t)>=0},Math.randomInt=function(t){return Math.floor(t*Math.random())},Utils.RPGMAKER_NAME="MV",Utils.RPGMAKER_VERSION="1.6.1",Utils.isOptionValid=function(t){return location.search.slice(1).split("&").contains(t)||"undefined"!=typeof nw&&nw.App.argv.length>0&&nw.App.argv[0].split("&").contains(t)?1:0},Utils.isNwjs=function(){return"function"==typeof require&&"object"==typeof process},Utils.isMobileDevice=function(){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;return!!navigator.userAgent.match(t)},Utils.isMobileSafari=function(){var t=navigator.userAgent;return!(!t.match(/iPhone|iPad|iPod/)||!t.match(/AppleWebKit/)||t.match("CriOS"))},Utils.isAndroidChrome=function(){var t=navigator.userAgent;return!(!t.match(/Android/)||!t.match(/Chrome/))},Utils.canReadGameFiles=function(){var t=document.getElementsByTagName("script"),e=t[t.length-1],i=new XMLHttpRequest;try{return i.open("GET",e.src),i.overrideMimeType("text/javascript"),i.send(),!0}catch(t){return!1}},Utils.rgbToCssColor=function(t,e,i){return"rgb("+(t=Math.round(t))+","+(e=Math.round(e))+","+(i=Math.round(i))+")"},Utils._id=1,Utils.generateRuntimeId=function(){return Utils._id++},Utils._supportPassiveEvent=null,Utils.isSupportPassiveEvent=function(){if("boolean"==typeof Utils._supportPassiveEvent)return Utils._supportPassiveEvent;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});return window.addEventListener("test",null,e),Utils._supportPassiveEvent=t,t},CacheEntry.prototype.free=function(t){this.freedByTTL=t||!1,this.cached&&(this.cached=!1,delete this.cache._inner[this.key])},CacheEntry.prototype.allocate=function(){return this.cached||(this.cache._inner[this.key]=this,this.cached=!0),this.touch(),this},CacheEntry.prototype.setTimeToLive=function(t,e){return this.ttlTicks=t||0,this.ttlSeconds=e||0,this},CacheEntry.prototype.isStillAlive=function(){var t=this.cache;return(0==this.ttlTicks||this.touchTicks+this.ttlTicks<t.updateTicks)&&(0==this.ttlSeconds||this.touchSeconds+this.ttlSeconds<t.updateSeconds)},CacheEntry.prototype.touch=function(){var t=this.cache;this.cached?(this.touchTicks=t.updateTicks,this.touchSeconds=t.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,t._inner[this.key]||(t._inner[this.key]=this))},CacheMap.prototype.checkTTL=function(){var t=this._inner,e=this._lastRemovedEntries;for(var i in e||(e=[],this._lastRemovedEntries=e),t){var r=t[i];r.isStillAlive()||e.push(r)}for(var n=0;n<e.length;n++)e[n].free(!0);e.length=0},CacheMap.prototype.getItem=function(t){var e=this._inner[t];return e?e.item:null},CacheMap.prototype.clear=function(){for(var t=Object.keys(this._inner),e=0;e<t.length;e++)this._inner[t[e]].free()},CacheMap.prototype.setItem=function(t,e){return new CacheEntry(this,t,e).allocate()},CacheMap.prototype.update=function(t,e){this.updateTicks+=t,this.updateSeconds+=e,this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())},ImageCache.limit=1e7,ImageCache.prototype.initialize=function(){this._items={}},ImageCache.prototype.add=function(t,e){this._items[t]={bitmap:e,touch:Date.now(),key:t},this._truncateCache()},ImageCache.prototype.get=function(t){if(this._items[t]){var e=this._items[t];return e.touch=Date.now(),e.bitmap}return null},ImageCache.prototype.reserve=function(t,e,i){this._items[t]||(this._items[t]={bitmap:e,touch:Date.now(),key:t}),this._items[t].reservationId=i},ImageCache.prototype.releaseReservation=function(t){var e=this._items;Object.keys(e).map(function(t){return e[t]}).forEach(function(e){e.reservationId===t&&delete e.reservationId})},ImageCache.prototype._truncateCache=function(){var t=this._items,e=ImageCache.limit;Object.keys(t).map(function(e){return t[e]}).sort(function(t,e){return e.touch-t.touch}).forEach(function(i){if(e>0||this._mustBeHeld(i)){var r=i.bitmap;e-=r.width*r.height}else delete t[i.key]}.bind(this))},ImageCache.prototype._mustBeHeld=function(t){return!t.bitmap.isRequestOnly()&&(!!t.reservationId||!t.bitmap.isReady())},ImageCache.prototype.isReady=function(){var t=this._items;return!Object.keys(t).some(function(e){return!t[e].bitmap.isRequestOnly()&&!t[e].bitmap.isReady()})},ImageCache.prototype.getErrorBitmap=function(){var t=this._items,e=null;return Object.keys(t).some(function(i){return!!t[i].bitmap.isError()&&(e=t[i].bitmap,!0)})?e:null},RequestQueue.prototype.initialize=function(){this._queue=[]},RequestQueue.prototype.enqueue=function(t,e){this._queue.push({key:t,value:e})},RequestQueue.prototype.update=function(){if(0!==this._queue.length){var t=this._queue[0];t.value.isRequestReady()?(this._queue.shift(),0!==this._queue.length&&this._queue[0].value.startRequest()):t.value.startRequest()}},RequestQueue.prototype.raisePriority=function(t){for(var e=0;e<this._queue.length;e++){var i=this._queue[e];if(i.key===t){this._queue.splice(e,1),this._queue.unshift(i);break}}},RequestQueue.prototype.clear=function(){this._queue.splice(0)},Point.prototype=Object.create(PIXI.Point.prototype),Point.prototype.constructor=Point,Point.prototype.initialize=function(t,e){PIXI.Point.call(this,t,e)},Rectangle.prototype=Object.create(PIXI.Rectangle.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.initialize=function(t,e,i,r){PIXI.Rectangle.call(this,t,e,i,r)},Rectangle.emptyRectangle=new Rectangle(0,0,0,0),Bitmap._reuseImages=[],Bitmap.prototype._createCanvas=function(t,e){if(this.__canvas=this.__canvas||document.createElement("canvas"),this.__context=this.__canvas.getContext("2d"),this.__canvas.width=Math.max(t||0,1),this.__canvas.height=Math.max(e||0,1),this._image){var i=Math.max(this._image.width||0,1),r=Math.max(this._image.height||0,1);this.__canvas.width=i,this.__canvas.height=r,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0)}this._setDirty()},Bitmap.prototype._createBaseTexture=function(t){this.__baseTexture=new PIXI.BaseTexture(t),this.__baseTexture.mipmap=!1,this.__baseTexture.width=t.width,this.__baseTexture.height=t.height,this._smooth?this._baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR:this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST},Bitmap.prototype._clearImgInstance=function(){this._image.src="",this._image.onload=null,this._image.onerror=null,this._errorListener=null,this._loadListener=null,Bitmap._reuseImages.push(this._image),this._image=null},Object.defineProperties(Bitmap.prototype,{_canvas:{get:function(){return this.__canvas||this._createCanvas(),this.__canvas}},_context:{get:function(){return this.__context||this._createCanvas(),this.__context}},_baseTexture:{get:function(){return this.__baseTexture||this._createBaseTexture(this._image||this.__canvas),this.__baseTexture}}}),Bitmap.prototype._renewCanvas=function(){var t=this._image;t&&this.__canvas&&(this.__canvas.width<t.width||this.__canvas.height<t.height)&&this._createCanvas()},Bitmap.prototype.initialize=function(t,e){this._defer||this._createCanvas(t,e),this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._loadingState="none",this._decodeAfterRequest=!1,this.cacheEntry=null,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4},Bitmap.load=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._decodeAfterRequest=!0,e._requestImage(t),e},Bitmap.snap=function(t){var e=Graphics.width,i=Graphics.height,r=new Bitmap(e,i),n=r._context,s=PIXI.RenderTexture.create(e,i);if(t){Graphics._renderer.render(t,s),t.worldTransform.identity();var o=null;o=Graphics.isWebGL()?Graphics._renderer.extract.canvas(s):s.baseTexture._canvasRenderTarget.canvas,n.drawImage(o,0,0)}return s.destroy({destroyBase:!0}),r._setDirty(),r},Bitmap.prototype.isReady=function(){return"loaded"===this._loadingState||"none"===this._loadingState},Bitmap.prototype.isError=function(){return"error"===this._loadingState},Bitmap.prototype.touch=function(){this.cacheEntry&&this.cacheEntry.touch()},Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0}),Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0}),Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0}),Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this.isReady()?this._image?this._image.width:this._canvas.width:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this.isReady()?this._image?this._image.height:this._canvas.height:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth!==t&&(this._smooth=t,this.__baseTexture&&(this._smooth?this._baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR:this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST))},configurable:!0}),Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0}),Bitmap.prototype.resize=function(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e},Bitmap.prototype.blt=function(t,e,i,r,n,s,o,a,h){a=a||r,h=h||n,e>=0&&i>=0&&r>0&&n>0&&a>0&&h>0&&e+r<=t.width&&i+n<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._canvas,e,i,r,n,s,o,a,h),this._setDirty())},Bitmap.prototype.bltImage=function(t,e,i,r,n,s,o,a,h){a=a||r,h=h||n,e>=0&&i>=0&&r>0&&n>0&&a>0&&h>0&&e+r<=t.width&&i+n<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._image,e,i,r,n,s,o,a,h),this._setDirty())},Bitmap.prototype.getPixel=function(t,e){for(var i=this._context.getImageData(t,e,1,1).data,r="#",n=0;n<3;n++)r+=i[n].toString(16).padZero(2);return r},Bitmap.prototype.getAlphaPixel=function(t,e){return this._context.getImageData(t,e,1,1).data[3]},Bitmap.prototype.clearRect=function(t,e,i,r){this._context.clearRect(t,e,i,r),this._setDirty()},Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)},Bitmap.prototype.fillRect=function(t,e,i,r,n){var s=this._context;s.save(),s.fillStyle=n,s.fillRect(t,e,i,r),s.restore(),this._setDirty()},Bitmap.prototype.fillAll=function(t){this.fillRect(0,0,this.width,this.height,t)},Bitmap.prototype.gradientFillRect=function(t,e,i,r,n,s,o){var a,h=this._context;(a=o?h.createLinearGradient(t,e,t,e+r):h.createLinearGradient(t,e,t+i,e)).addColorStop(0,n),a.addColorStop(1,s),h.save(),h.fillStyle=a,h.fillRect(t,e,i,r),h.restore(),this._setDirty()},Bitmap.prototype.drawCircle=function(t,e,i,r){var n=this._context;n.save(),n.fillStyle=r,n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.fill(),n.restore(),this._setDirty()},Bitmap.prototype.drawText=function(t,e,i,r,n,s){if(void 0!==t){var o=e,a=i+n-(n-.7*this.fontSize)/2,h=this._context,p=h.globalAlpha;r=r||4294967295,"center"===s&&(o+=r/2),"right"===s&&(o+=r),h.save(),h.font=this._makeFontNameText(),h.textAlign=s,h.textBaseline="alphabetic",h.globalAlpha=1,this._drawTextOutline(t,o,a,r),h.globalAlpha=p,this._drawTextBody(t,o,a,r),h.restore(),this._setDirty()}},Bitmap.prototype.measureTextWidth=function(t){var e=this._context;e.save(),e.font=this._makeFontNameText();var i=e.measureText(t).width;return e.restore(),i},Bitmap.prototype.adjustTone=function(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){for(var r=this._context,n=r.getImageData(0,0,this.width,this.height),s=n.data,o=0;o<s.length;o+=4)s[o+0]+=t,s[o+1]+=e,s[o+2]+=i;r.putImageData(n,0,0),this._setDirty()}},Bitmap.prototype.rotateHue=function(t){function e(t,e,i){var r=Math.min(t,e,i),n=Math.max(t,e,i),s=0,o=0,a=(r+n)/2,h=n-r;return h>0&&(s=t===n?((e-i)/h+6)%6*60:e===n?60*((i-t)/h+2):60*((t-e)/h+4),o=h/(255-Math.abs(2*a-255))),[s,o,a]}function i(t,e,i){var r=(255-Math.abs(2*i-255))*e,n=i-r/2,s=r+n,o=r*(1-Math.abs(t/60%2-1))+n;return t<60?[s,o,n]:t<120?[o,s,n]:t<180?[n,s,o]:t<240?[n,o,s]:t<300?[o,n,s]:[s,n,o]}if(t&&this.width>0&&this.height>0){t=(t%360+360)%360;for(var r=this._context,n=r.getImageData(0,0,this.width,this.height),s=n.data,o=0;o<s.length;o+=4){var a=e(s[o+0],s[o+1],s[o+2]),h=i((a[0]+t)%360,a[1],a[2]);s[o+0]=h[0],s[o+1]=h[1],s[o+2]=h[2]}r.putImageData(n,0,0),this._setDirty()}},Bitmap.prototype.blur=function(){for(var t=0;t<2;t++){var e=this.width,i=this.height,r=this._canvas,n=this._context,s=document.createElement("canvas"),o=s.getContext("2d");s.width=e+2,s.height=i+2,o.drawImage(r,0,0,e,i,1,1,e,i),o.drawImage(r,0,0,e,1,1,0,e,1),o.drawImage(r,0,0,1,i,0,1,1,i),o.drawImage(r,0,i-1,e,1,1,i+1,e,1),o.drawImage(r,e-1,0,1,i,e+1,1,1,i),n.save(),n.fillStyle="black",n.fillRect(0,0,e,i),n.globalCompositeOperation="lighter",n.globalAlpha=1/9;for(var a=0;a<3;a++)for(var h=0;h<3;h++)n.drawImage(s,h,a,e,i,0,0,e,i);n.restore()}this._setDirty()},Bitmap.prototype.addLoadListener=function(t){this.isReady()?t(this):this._loadListeners.push(t)},Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace},Bitmap.prototype._drawTextOutline=function(t,e,i,r){var n=this._context;n.strokeStyle=this.outlineColor,n.lineWidth=this.outlineWidth,n.lineJoin="round",n.strokeText(t,e,i,r)},Bitmap.prototype._drawTextBody=function(t,e,i,r){var n=this._context;n.fillStyle=this.textColor,n.fillText(t,e,i,r)},Bitmap.prototype._onLoad=function(){switch(this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._renewCanvas(),this._loadingState){case"requesting":this._loadingState="requestCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case"decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance())}},Bitmap.prototype.decode=function(){switch(this._loadingState){case"requestCompleted":case"decryptCompleted":this._loadingState="loaded",this.__canvas||this._createBaseTexture(this._image),this._setDirty(),this._callLoadListeners();break;case"requesting":case"decrypting":this._decodeAfterRequest=!0,this._loader||(this._loader=ResourceHandler.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",this._errorListener=this._loader));break;case"pending":case"purged":case"error":this._decodeAfterRequest=!0,this._requestImage(this._url)}},Bitmap.prototype._callLoadListeners=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()(this)}},Bitmap.prototype._onError=function(){this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._loadingState="error"},Bitmap.prototype._setDirty=function(){this._dirty=!0},Bitmap.prototype.checkDirty=function(){this._dirty&&(this._baseTexture.update(),this._dirty=!1)},Bitmap.request=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._url=t,e._loadingState="pending",e},Bitmap.prototype._requestImage=function(t){0!==Bitmap._reuseImages.length?this._image=Bitmap._reuseImages.pop():this._image=new Image,this._decodeAfterRequest&&!this._loader&&(this._loader=ResourceHandler.createLoader(t,this._requestImage.bind(this,t),this._onError.bind(this))),this._image=new Image,this._url=t,this._loadingState="requesting",!Decrypter.checkImgIgnore(t)&&Decrypter.hasEncryptedImages?(this._loadingState="decrypting",Decrypter.decryptImg(t,this)):(this._image.src=t,this._image.addEventListener("load",this._loadListener=Bitmap.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||Bitmap.prototype._onError.bind(this)))},Bitmap.prototype.isRequestOnly=function(){return!(this._decodeAfterRequest||this.isReady())},Bitmap.prototype.isRequestReady=function(){return"pending"!==this._loadingState&&"requesting"!==this._loadingState&&"decrypting"!==this._loadingState},Bitmap.prototype.startRequest=function(){"pending"===this._loadingState&&(this._decodeAfterRequest=!1,this._requestImage(this._url))},Graphics._cssFontLoading=document.fonts&&document.fonts.ready,Graphics._fontLoaded=null,Graphics._videoVolume=1,Graphics.initialize=function(t,e,i){this._width=t||800,this._height=e||600,this._rendererType=i||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._scale=1,this._realScale=1,this._errorShowed=!1,this._errorPrinter=null,this._canvas=null,this._video=null,this._videoUnlocked=!1,this._videoLoading=!1,this._upperCanvas=null,this._renderer=null,this._fpsMeter=null,this._modeBox=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseDifferenceBlend=!1,this._canUseSaturationBlend=!1,this._hiddenCanvas=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers(),this._setupCssFontLoading()},Graphics._setupCssFontLoading=function(){Graphics._cssFontLoading&&document.fonts.ready.then(function(t){Graphics._fontLoaded=t}).catch(function(t){SceneManager.onError(t)})},Graphics.canUseCssFontLoading=function(){return!!this._cssFontLoading},Graphics.frameCount=0,Graphics.BLEND_NORMAL=0,Graphics.BLEND_ADD=1,Graphics.BLEND_MULTIPLY=2,Graphics.BLEND_SCREEN=3,Graphics.tickStart=function(){this._fpsMeter&&this._fpsMeter.tickStart()},Graphics.tickEnd=function(){this._fpsMeter&&this._rendered&&this._fpsMeter.tick()},Graphics.render=function(t){if(0===this._skipCount){var e=Date.now();t&&(this._renderer.render(t),this._renderer.gl&&this._renderer.gl.flush&&this._renderer.gl.flush());var i=Date.now()-e;this._skipCount=Math.min(Math.floor(i/15),this._maxSkip),this._rendered=!0}else this._skipCount--,this._rendered=!1;this.frameCount++},Graphics.isWebGL=function(){return this._renderer&&this._renderer.type===PIXI.RENDERER_TYPE.WEBGL},Graphics.hasWebGL=function(){try{var t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},Graphics.canUseDifferenceBlend=function(){return this._canUseDifferenceBlend},Graphics.canUseSaturationBlend=function(){return this._canUseSaturationBlend},Graphics.setLoadingImage=function(t){this._loadingImage=new Image,this._loadingImage.src=t},Graphics.startLoading=function(){this._loadingCount=0},Graphics.updateLoading=function(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1},Graphics.endLoading=function(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0},Graphics.printLoadingError=function(t){if(this._errorPrinter&&!this._errorShowed){this._errorPrinter.innerHTML=this._makeErrorHtml("Loading Error","Failed to load: "+t);var e=document.createElement("button");e.innerHTML="Retry",e.style.fontSize="24px",e.style.color="#ffffff",e.style.backgroundColor="#000000",e.onmousedown=e.ontouchstart=function(t){ResourceHandler.retry(),t.stopPropagation()},this._errorPrinter.appendChild(e),this._loadingCount=-1/0}},Graphics.eraseLoadingError=function(){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML="",this.startLoading())},Graphics.printError=function(t,e){this._errorShowed=!0,this._errorPrinter&&(this._errorPrinter.innerHTML=this._makeErrorHtml(t,e)),this._applyCanvasFilter(),this._clearUpperCanvas()},Graphics.showFps=function(){this._fpsMeter&&(this._fpsMeter.show(),this._modeBox.style.opacity=1)},Graphics.hideFps=function(){this._fpsMeter&&(this._fpsMeter.hide(),this._modeBox.style.opacity=0)},Graphics.loadFont=function(t,e){var i=document.createElement("style"),r=document.getElementsByTagName("head"),n='@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';i.type="text/css",r.item(0).appendChild(i),i.sheet.insertRule(n,0),this._createFontLoader(t)},Graphics.isFontLoaded=function(t){if(Graphics._cssFontLoading)return!!Graphics._fontLoaded&&Graphics._fontLoaded.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));var e,i=this._hiddenCanvas.getContext("2d"),r="abcdefghijklmnopqrstuvwxyz";return i.font="40px "+t+", sans-serif",e=i.measureText(r).width,i.font="40px sans-serif",e!==i.measureText(r).width},Graphics.playVideo=function(t){this._videoLoader=ResourceHandler.createLoader(null,this._playVideo.bind(this,t),this._onVideoError.bind(this)),this._playVideo(t)},Graphics._playVideo=function(t){this._video.src=t,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._videoLoader,this._video.onended=this._onVideoEnd.bind(this),this._video.load(),this._videoLoading=!0},Graphics.isVideoPlaying=function(){return this._videoLoading||this._isVideoVisible()},Graphics.canPlayVideoType=function(t){return this._video&&this._video.canPlayType(t)},Graphics.setVideoVolume=function(t){this._videoVolume=t,this._video&&(this._video.volume=this._videoVolume)},Graphics.pageToCanvasX=function(t){if(this._canvas){var e=this._canvas.offsetLeft;return Math.round((t-e)/this._realScale)}return 0},Graphics.pageToCanvasY=function(t){if(this._canvas){var e=this._canvas.offsetTop;return Math.round((t-e)/this._realScale)}return 0},Graphics.isInsideCanvas=function(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height},Graphics.callGC=function(){Graphics.isWebGL()&&Graphics._renderer.textureGC.run()},Object.defineProperty(Graphics,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"boxWidth",{get:function(){return this._boxWidth},set:function(t){this._boxWidth=t},configurable:!0}),Object.defineProperty(Graphics,"boxHeight",{get:function(){return this._boxHeight},set:function(t){this._boxHeight=t},configurable:!0}),Object.defineProperty(Graphics,"scale",{get:function(){return this._scale},set:function(t){this._scale!==t&&(this._scale=t,this._updateAllElements())},configurable:!0}),Graphics._createAllElements=function(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()},Graphics._updateAllElements=function(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas()},Graphics._updateRealScale=function(){if(this._stretchEnabled){var t=window.innerWidth/this._width,e=window.innerHeight/this._height;t>=1&&t-.01<=1&&(t=1),e>=1&&e-.01<=1&&(e=1),this._realScale=Math.min(t,e)}else this._realScale=this._scale},Graphics._makeErrorHtml=function(t,e){return'<font color="yellow"><b>'+t+'</b></font><br><font color="white">'+e+"</font><br>"},Graphics._defaultStretchMode=function(){return Utils.isNwjs()||Utils.isMobileDevice()},Graphics._testCanvasBlendModes=function(){var t,e,i,r;(t=document.createElement("canvas")).width=1,t.height=1,(e=t.getContext("2d")).globalCompositeOperation="source-over",e.fillStyle="white",e.fillRect(0,0,1,1),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,1,1),i=e.getImageData(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="black",e.fillRect(0,0,1,1),e.globalCompositeOperation="saturation",e.fillStyle="white",e.fillRect(0,0,1,1),r=e.getImageData(0,0,1,1),this._canUseDifferenceBlend=0===i.data[0],this._canUseSaturationBlend=0===r.data[0]},Graphics._modifyExistingElements=function(){for(var t=document.getElementsByTagName("*"),e=0;e<t.length;e++)t[e].style.zIndex>0&&(t[e].style.zIndex=0)},Graphics._createErrorPrinter=function(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)},Graphics._updateErrorPrinter=function(){this._errorPrinter.width=.9*this._width,this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)},Graphics._createCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)},Graphics._updateCanvas=function(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)},Graphics._createVideo=function(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._video.setAttribute("playsinline",""),this._video.volume=this._videoVolume,this._updateVideo(),makeVideoPlayableInline(this._video),document.body.appendChild(this._video)},Graphics._updateVideo=function(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)},Graphics._createUpperCanvas=function(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)},Graphics._updateUpperCanvas=function(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)},Graphics._clearUpperCanvas=function(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)},Graphics._paintUpperCanvas=function(){if(this._clearUpperCanvas(),this._loadingImage&&this._loadingCount>=20){var t=this._upperCanvas.getContext("2d"),e=(this._width-this._loadingImage.width)/2,i=(this._height-this._loadingImage.height)/2,r=((this._loadingCount-20)/30).clamp(0,1);t.save(),t.globalAlpha=r,t.drawImage(this._loadingImage,e,i),t.restore()}},Graphics._createRenderer=function(){PIXI.dontSayHello=!0;var t=this._width,e=this._height,i={view:this._canvas};try{switch(this._rendererType){case"canvas":this._renderer=new PIXI.CanvasRenderer(t,e,i);break;case"webgl":this._renderer=new PIXI.WebGLRenderer(t,e,i);break;default:this._renderer=PIXI.autoDetectRenderer(t,e,i)}this._renderer&&this._renderer.textureGC&&(this._renderer.textureGC.maxIdle=1)}catch(t){this._renderer=null}},Graphics._updateRenderer=function(){this._renderer&&this._renderer.resize(this._width,this._height)},Graphics._createFPSMeter=function(){var t={graph:1,decimals:0,theme:"transparent",toggleOn:null};this._fpsMeter=new FPSMeter(t),this._fpsMeter.hide()},Graphics._createModeBox=function(){var t=document.createElement("div");t.id="modeTextBack",t.style.position="absolute",t.style.left="5px",t.style.top="5px",t.style.width="119px",t.style.height="58px",t.style.background="rgba(0,0,0,0.2)",t.style.zIndex=9,t.style.opacity=0;var e=document.createElement("div");e.id="modeText",e.style.position="absolute",e.style.left="0px",e.style.top="41px",e.style.width="119px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="white",e.style.textAlign="center",e.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",e.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(t),t.appendChild(e),this._modeBox=t},Graphics._createGameFontLoader=function(){this._createFontLoader("GameFont")},Graphics._createFontLoader=function(t){var e=document.createElement("div"),i=document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),document.body.appendChild(e)},Graphics._centerElement=function(t){var e=t.width*this._realScale,i=t.height*this._realScale;t.style.position="absolute",t.style.margin="auto",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.width=e+"px",t.style.height=i+"px"},Graphics._disableTextSelection=function(){var t=document.body;t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.mozUserSelect="none"},Graphics._disableContextMenu=function(){for(var t=document.body.getElementsByTagName("*"),e=function(){return!1},i=0;i<t.length;i++)t[i].oncontextmenu=e},Graphics._applyCanvasFilter=function(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")},Graphics._onVideoLoad=function(){this._video.play(),this._updateVisibility(!0),this._videoLoading=!1},Graphics._onVideoError=function(){this._updateVisibility(!1),this._videoLoading=!1},Graphics._onVideoEnd=function(){this._updateVisibility(!1)},Graphics._updateVisibility=function(t){this._video.style.opacity=t?1:0,this._canvas.style.opacity=t?0:1},Graphics._isVideoVisible=function(){return this._video.style.opacity>0},Graphics._setupEventHandlers=function(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keydown",this._onTouchEnd.bind(this)),document.addEventListener("mousedown",this._onTouchEnd.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this))},Graphics._onWindowResize=function(){this._updateAllElements()},Graphics._onKeyDown=function(t){
if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 113:t.preventDefault(),this._switchFPSMeter();break;case 114:t.preventDefault(),this._switchStretchMode();break;case 115:t.preventDefault(),this._switchFullScreen()}},Graphics._onTouchEnd=function(){this._videoUnlocked||(this._video.play(),this._videoUnlocked=!0),this._isVideoVisible()&&this._video.paused&&this._video.play()},Graphics._switchFPSMeter=function(){this._fpsMeter.isPaused?(this.showFps(),this._fpsMeter.showFps(),this._fpsMeterToggled=!1):this._fpsMeterToggled?this.hideFps():(this._fpsMeter.showDuration(),this._fpsMeterToggled=!0)},Graphics._switchStretchMode=function(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()},Graphics._switchFullScreen=function(){this._isFullScreen()?this._requestFullScreen():this._cancelFullScreen()},Graphics._isFullScreen=function(){return document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitFullscreenElement&&!document.msFullscreenElement},Graphics._requestFullScreen=function(){var t=document.body;t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()},Graphics._cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},Input.initialize=function(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()},Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Input.clear=function(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0},Input.update=function(){for(var t in this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null,this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()},Input.isPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isPressed("escape"))||!!this._currentState[t]},Input.isTriggered=function(t){return!(!this._isEscapeCompatible(t)||!this.isTriggered("escape"))||this._latestButton===t&&0===this._pressedTime},Input.isRepeated=function(t){return!(!this._isEscapeCompatible(t)||!this.isRepeated("escape"))||this._latestButton===t&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)},Input.isLongPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isLongPressed("escape"))||this._latestButton===t&&this._pressedTime>=this.keyRepeatWait},Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0}),Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var t=window.alert;window.alert=function(){var e=require("nw.gui").Window.get();t.apply(this,arguments),e.focus(),Input.clear()}}},Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))},Input._onKeyDown=function(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),144===t.keyCode&&this.clear();var e=this.keyMapper[t.keyCode];ResourceHandler.exists()&&"ok"===e?ResourceHandler.retry():e&&(this._currentState[e]=!0)},Input._shouldPreventDefault=function(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1},Input._onKeyUp=function(t){var e=this.keyMapper[t.keyCode];e&&(this._currentState[e]=!1),0===t.keyCode&&this.clear()},Input._onLostFocus=function(){this.clear()},Input._pollGamepads=function(){if(navigator.getGamepads){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var i=t[e];i&&i.connected&&this._updateGamepadState(i)}}},Input._updateGamepadState=function(t){var e=this._gamepadStates[t.index]||[],i=[],r=t.buttons,n=t.axes,s=.5;i[12]=!1,i[13]=!1,i[14]=!1,i[15]=!1;for(var o=0;o<r.length;o++)i[o]=r[o].pressed;n[1]<-s?i[12]=!0:n[1]>s&&(i[13]=!0),n[0]<-s?i[14]=!0:n[0]>s&&(i[15]=!0);for(var a=0;a<i.length;a++)if(i[a]!==e[a]){var h=this.gamepadMapper[a];h&&(this._currentState[h]=i[a])}this._gamepadStates[t.index]=i},Input._updateDirection=function(){var t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),0!==t&&0!==e?"x"===this._preferredAxis?e=0:t=0:0!==t?this._preferredAxis="y":0!==e&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)},Input._signX=function(){var t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t},Input._signY=function(){var t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t},Input._makeNumpadDirection=function(t,e){return 0!==t||0!==e?5-3*e+t:0},Input._isEscapeCompatible=function(t){return"cancel"===t||"menu"===t},TouchInput.initialize=function(){this.clear(),this._setupEventHandlers()},TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,TouchInput.clear=function(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0},TouchInput.update=function(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++},TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed},TouchInput.isTriggered=function(){return this._triggered},TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)},TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait},TouchInput.isCancelled=function(){return this._cancelled},TouchInput.isMoved=function(){return this._moved},TouchInput.isReleased=function(){return this._released},Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0}),TouchInput._setupEventHandlers=function(){var t=Utils.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this),!!t&&{passive:!1}),document.addEventListener("touchmove",this._onTouchMove.bind(this),!!t&&{passive:!1}),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this))},TouchInput._onMouseDown=function(t){0===t.button?this._onLeftButtonDown(t):1===t.button?this._onMiddleButtonDown(t):2===t.button&&this._onRightButtonDown(t)},TouchInput._onLeftButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(e,i))},TouchInput._onMiddleButtonDown=function(){},TouchInput._onRightButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&this._onCancel(e,i)},TouchInput._onMouseMove=function(t){if(this._mousePressed){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._onMove(e,i)}},TouchInput._onMouseUp=function(t){if(0===t.button){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._mousePressed=!1,this._onRelease(e,i)}},TouchInput._onWheel=function(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()},TouchInput._onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],r=Graphics.pageToCanvasX(i.pageX),n=Graphics.pageToCanvasY(i.pageY);Graphics.isInsideCanvas(r,n)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(r,n):this._onTrigger(r,n),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()},TouchInput._onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],r=Graphics.pageToCanvasX(i.pageX),n=Graphics.pageToCanvasY(i.pageY);this._onMove(r,n)}},TouchInput._onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],r=Graphics.pageToCanvasX(i.pageX),n=Graphics.pageToCanvasY(i.pageY);this._screenPressed=!1,this._onRelease(r,n)}},TouchInput._onTouchCancel=function(){this._screenPressed=!1},TouchInput._onPointerDown=function(t){if("touch"===t.pointerType&&!t.isPrimary){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}},TouchInput._onTrigger=function(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()},TouchInput._onCancel=function(t,e){this._events.cancelled=!0,this._x=t,this._y=e},TouchInput._onMove=function(t,e){this._events.moved=!0,this._x=t,this._y=e},TouchInput._onRelease=function(t,e){this._events.released=!0,this._x=t,this._y=e},Sprite.prototype=Object.create(PIXI.Sprite.prototype),Sprite.prototype.constructor=Sprite,Sprite.voidFilter=new PIXI.filters.VoidFilter,Sprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this._isPicture=!1,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=t},Sprite._counter=0,Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,t?(this._refreshFrame=!0,t.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Sprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},Sprite.prototype.move=function(t,e){this.x=t,this.y=e},Sprite.prototype.setFrame=function(t,e,i,r){this._refreshFrame=!1;var n=this._frame;t===n.x&&e===n.y&&i===n.width&&r===n.height||(n.x=t,n.y=e,n.width=i,n.height=r,this._refresh())},Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()},Sprite.prototype.setBlendColor=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())},Sprite.prototype.getColorTone=function(){return this._colorTone.clone()},Sprite.prototype.setColorTone=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())},Sprite.prototype._onBitmapLoad=function(t){t===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()},Sprite.prototype._refresh=function(){var t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),r=Math.floor(this._frame.height),n=this._bitmap?this._bitmap.width:0,s=this._bitmap?this._bitmap.height:0,o=t.clamp(0,n),a=e.clamp(0,s),h=(i-o+t).clamp(0,n-o),p=(r-a+e).clamp(0,s-a);this._realFrame.x=o,this._realFrame.y=a,this._realFrame.width=h,this._realFrame.height=p,this.pivot.x=t-o,this.pivot.y=e-a,h>0&&p>0?this._needsTint()?(this._createTinter(h,p),this._executeTint(o,a,h,p),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new Rectangle(0,0,h,p)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame):this._bitmap?this.texture.frame=Rectangle.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=this._frame),this.texture._updateID++},Sprite.prototype._isInBitmapRect=function(t,e,i,r){return this._bitmap&&t+i>0&&e+r>0&&t<this._bitmap.width&&e<this._bitmap.height},Sprite.prototype._needsTint=function(){var t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||this._blendColor[3]>0},Sprite.prototype._createTinter=function(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode},Sprite.prototype._executeTint=function(t,e,i,r){var n=this._context,s=this._colorTone,o=this._blendColor;if(n.globalCompositeOperation="copy",n.drawImage(this._bitmap.canvas,t,e,i,r,0,0,i,r),Graphics.canUseSaturationBlend()){var a=Math.max(0,s[3]);n.globalCompositeOperation="saturation",n.fillStyle="rgba(255,255,255,"+a/255+")",n.fillRect(0,0,i,r)}var h=Math.max(0,s[0]),p=Math.max(0,s[1]),l=Math.max(0,s[2]);if(n.globalCompositeOperation="lighter",n.fillStyle=Utils.rgbToCssColor(h,p,l),n.fillRect(0,0,i,r),Graphics.canUseDifferenceBlend()){n.globalCompositeOperation="difference",n.fillStyle="white",n.fillRect(0,0,i,r);var c=Math.max(0,-s[0]),d=Math.max(0,-s[1]),u=Math.max(0,-s[2]);n.globalCompositeOperation="lighter",n.fillStyle=Utils.rgbToCssColor(c,d,u),n.fillRect(0,0,i,r),n.globalCompositeOperation="difference",n.fillStyle="white",n.fillRect(0,0,i,r)}var _=Math.max(0,o[0]),f=Math.max(0,o[1]),m=Math.max(0,o[2]),g=Math.max(0,o[3]);n.globalCompositeOperation="source-atop",n.fillStyle=Utils.rgbToCssColor(_,f,m),n.globalAlpha=g/255,n.fillRect(0,0,i,r),n.globalCompositeOperation="destination-in",n.globalAlpha=1,n.drawImage(this._bitmap.canvas,t,e,i,r,0,0,i,r)},Sprite.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas,Sprite.prototype._renderWebGL_PIXI=PIXI.Sprite.prototype._renderWebGL,Sprite.prototype._renderCanvas=function(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)},Sprite.prototype._speedUpCustomBlendModes=function(t){var e=t.plugins.picture,i=this.blendMode;if(t.renderingToScreen&&t._activeRenderTarget.root&&e.drawModes[i]){var r=t._lastObjectRendered,n=r._filters;n&&n[0]||setTimeout(function(){var t=r._filters;t&&t[0]||(r.filters=[Sprite.voidFilter],r.filterArea=new PIXI.Rectangle(0,0,Graphics.width,Graphics.height))},0)}},Sprite.prototype._renderWebGL=function(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this.calculateVertices(),"sprite"===this.pluginName&&this._isPicture?(this._speedUpCustomBlendModes(t),t.setObjectRenderer(t.plugins.picture),t.plugins.picture.render(this)):(t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)))},Tilemap.prototype=Object.create(PIXI.Container.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype.initialize=function(){PIXI.Container.call(this),this._margin=20,this._width=Graphics.width+2*this._margin,this._height=Graphics.height+2*this._margin,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()},Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}}),Tilemap.prototype.setData=function(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i},Tilemap.prototype.isReady=function(){for(var t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0},Tilemap.prototype.update=function(){this.animationCount++,this.animationFrame=Math.floor(this.animationCount/30),this.children.forEach(function(t){t.update&&t.update()});for(var t=0;t<this.bitmaps.length;t++)this.bitmaps[t]&&this.bitmaps[t].touch()},Tilemap.prototype.refresh=function(){this._lastTiles.length=0},Tilemap.prototype.refreshTileset=function(){},Tilemap.prototype.updateTransform=function(){var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),r=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,r),(this._needsRepaint||this._lastAnimationFrame!==this.animationFrame||this._lastStartX!==i||this._lastStartY!==r)&&(this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=i,this._lastStartY=r,this._paintAllTiles(i,r),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},Tilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=this._margin,r=Math.ceil(t/this._tileWidth)+1,n=Math.ceil(e/this._tileHeight)+1,s=r*this._tileWidth,o=n*this._tileHeight;this._lowerBitmap=new Bitmap(s,o),this._upperBitmap=new Bitmap(s,o),this._layerWidth=s,this._layerHeight=o,this._lowerLayer=new Sprite,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4;for(var a=0;a<4;a++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)},Tilemap.prototype._updateLayerPositions=function(){for(var t=this._margin,e=Math.floor(this.origin.x),i=Math.floor(this.origin.y),r=(e-t).mod(this._layerWidth),n=(i-t).mod(this._layerHeight),s=this._layerWidth-r,o=this._layerHeight-n,a=this._width-s,h=this._height-o,p=0;p<2;p++){var l;(l=0===p?this._lowerLayer.children:this._upperLayer.children)[0].move(0,0,s,o),l[0].setFrame(r,n,s,o),l[1].move(s,0,a,o),l[1].setFrame(0,n,a,o),l[2].move(0,o,s,h),l[2].setFrame(r,0,s,h),l[3].move(s,o,a,h),l[3].setFrame(0,0,a,h)}},Tilemap.prototype._paintAllTiles=function(t,e){for(var i=Math.ceil(this._width/this._tileWidth)+1,r=Math.ceil(this._height/this._tileHeight)+1,n=0;n<r;n++)for(var s=0;s<i;s++)this._paintTiles(t,e,s,n)},Tilemap.prototype._paintTiles=function(t,e,i,r){var n=1e4,s=t+i,o=e+r,a=(s*this._tileWidth).mod(this._layerWidth),h=(o*this._tileHeight).mod(this._layerHeight),p=a/this._tileWidth,l=h/this._tileHeight,c=this._readMapData(s,o,0),d=this._readMapData(s,o,1),u=this._readMapData(s,o,2),_=this._readMapData(s,o,3),f=this._readMapData(s,o,4),m=this._readMapData(s,o-1,1),g=[],y=[];this._isHigherTile(c)?y.push(c):g.push(c),this._isHigherTile(d)?y.push(d):g.push(d),g.push(-f),this._isTableTile(m)&&!this._isTableTile(d)&&(Tilemap.isShadowingTile(c)||g.push(n+m)),this._isOverpassPosition(s,o)?(y.push(u),y.push(_)):(this._isHigherTile(u)?y.push(u):g.push(u),this._isHigherTile(_)?y.push(_):g.push(_));var w=this._readLastTiles(0,p,l);if(!g.equals(w)||Tilemap.isTileA1(c)&&this._frameUpdated){this._lowerBitmap.clearRect(a,h,this._tileWidth,this._tileHeight);for(var T=0;T<g.length;T++){var v=g[T];v<0?this._drawShadow(this._lowerBitmap,f,a,h):v>=n?this._drawTableEdge(this._lowerBitmap,m,a,h):this._drawTile(this._lowerBitmap,v,a,h)}this._writeLastTiles(0,p,l,g)}var b=this._readLastTiles(1,p,l);if(!y.equals(b)){this._upperBitmap.clearRect(a,h,this._tileWidth,this._tileHeight);for(var S=0;S<y.length;S++)this._drawTile(this._upperBitmap,y[S],a,h);this._writeLastTiles(1,p,l,y)}},Tilemap.prototype._readLastTiles=function(t,e,i){var r=this._lastTiles[t];if(r){var n=r[i];if(n){var s=n[e];if(s)return s}}return[]},Tilemap.prototype._writeLastTiles=function(t,e,i,r){var n=this._lastTiles[t];n||(n=this._lastTiles[t]=[]);var s=n[i];s||(s=n[i]=[]),s[e]=r},Tilemap.prototype._drawTile=function(t,e,i,r){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,r):this._drawNormalTile(t,e,i,r))},Tilemap.prototype._drawNormalTile=function(t,e,i,r){var n=0;n=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);var s=this._tileWidth,o=this._tileHeight,a=(Math.floor(e/128)%2*8+e%8)*s,h=Math.floor(e%256/8)%16*o,p=this.bitmaps[n];p&&t.bltImage(p,a,h,s,o,i,r,s,o)},Tilemap.prototype._drawAutotile=function(t,e,i,r){var n=Tilemap.FLOOR_AUTOTILE_TABLE,s=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=s%8,h=Math.floor(s/8),p=0,l=0,c=0,d=!1;if(Tilemap.isTileA1(e)){var u=[0,1,2,1][this.animationFrame%4];c=0,0===s?(p=2*u,l=0):1===s?(p=2*u,l=3):2===s?(p=6,l=0):3===s?(p=6,l=3):(p=8*Math.floor(a/4),l=6*h+Math.floor(a/2)%2*3,s%2==0?p+=2*u:(p+=6,n=Tilemap.WATERFALL_AUTOTILE_TABLE,l+=this.animationFrame%3))}else Tilemap.isTileA2(e)?(c=1,p=2*a,l=3*(h-2),d=this._isTableTile(e)):Tilemap.isTileA3(e)?(c=2,p=2*a,l=2*(h-6),n=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(c=3,p=2*a,l=Math.floor(2.5*(h-10)+(h%2==1?.5:0)),h%2==1&&(n=Tilemap.WALL_AUTOTILE_TABLE));var _=n[o],f=this.bitmaps[c];if(_&&f)for(var m=this._tileWidth/2,g=this._tileHeight/2,y=0;y<4;y++){var w=_[y][0],T=_[y][1],v=(2*p+w)*m,b=(2*l+T)*g,S=i+y%2*m,I=r+Math.floor(y/2)*g;if(!d||1!==T&&5!==T)t.bltImage(f,v,b,m,g,S,I,m,g);else{var A=w,C=3;1===T&&(A=[0,3,2,1][w]);var L=(2*p+A)*m,x=(2*l+C)*g;t.bltImage(f,L,x,m,g,S,I,m,g),I+=g/2,t.bltImage(f,v,b,m,g/2,S,I,m,g/2)}}},Tilemap.prototype._drawTableEdge=function(t,e,i,r){if(Tilemap.isTileA2(e)){var n=Tilemap.FLOOR_AUTOTILE_TABLE,s=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=1,h=2*(s%8),p=3*(Math.floor(s/8)-2),l=n[o];if(l)for(var c=this.bitmaps[a],d=this._tileWidth/2,u=this._tileHeight/2,_=0;_<2;_++){var f=(2*h+l[2+_][0])*d,m=(2*p+l[2+_][1])*u+u/2,g=i+_%2*d,y=r+Math.floor(_/2)*u;t.bltImage(c,f,m,d,u/2,g,y,d,u/2)}}},Tilemap.prototype._drawShadow=function(t,e,i,r){if(15&e)for(var n=this._tileWidth/2,s=this._tileHeight/2,o="rgba(0,0,0,0.5)",a=0;a<4;a++)if(e&1<<a){var h=i+a%2*n,p=r+Math.floor(a/2)*s;t.fillRect(h,p,n,s,o)}},Tilemap.prototype._readMapData=function(t,e,i){if(this._mapData){var r=this._mapWidth,n=this._mapHeight;return this.horizontalWrap&&(t=t.mod(r)),this.verticalWrap&&(e=e.mod(n)),t>=0&&t<r&&e>=0&&e<n&&this._mapData[(i*n+e)*r+t]||0}return 0},Tilemap.prototype._isHigherTile=function(t){return 16&this.flags[t]},Tilemap.prototype._isTableTile=function(t){return Tilemap.isTileA2(t)&&128&this.flags[t]},Tilemap.prototype._isOverpassPosition=function(){return!1},Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))},Tilemap.prototype._compareChildOrder=function(t,e){return t.z!==e.z?t.z-e.z:t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId},Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.isVisibleTile=function(t){return t>0&&t<this.TILE_ID_MAX},Tilemap.isAutotile=function(t){return t>=this.TILE_ID_A1},Tilemap.getAutotileKind=function(t){return Math.floor((t-this.TILE_ID_A1)/48)},Tilemap.getAutotileShape=function(t){return(t-this.TILE_ID_A1)%48},Tilemap.makeAutotileId=function(t,e){return this.TILE_ID_A1+48*t+e},Tilemap.isSameKindTile=function(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e},Tilemap.isTileA1=function(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2},Tilemap.isTileA2=function(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3},Tilemap.isTileA3=function(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4},Tilemap.isTileA4=function(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX},Tilemap.isTileA5=function(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1},Tilemap.isWaterTile=function(t){return!!this.isTileA1(t)&&!(t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192)},Tilemap.isWaterfallTile=function(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2&&this.getAutotileKind(t)%2==1},Tilemap.isGroundTile=function(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)},Tilemap.isShadowingTile=function(t){return this.isTileA3(t)||this.isTileA4(t)},Tilemap.isRoofTile=function(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallTopTile=function(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallSideTile=function(t){return(this.isTileA3(t)||this.isTileA4(t))&&this.getAutotileKind(t)%16>=8},Tilemap.isWallTile=function(t){return this.isWallTopTile(t)||this.isWallSideTile(t)},Tilemap.isFloorTypeAutotile=function(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)},Tilemap.isWallTypeAutotile=function(t){return this.isRoofTile(t)||this.isWallSideTile(t)},Tilemap.isWaterfallTypeAutotile=function(t){return this.isWaterfallTile(t)},Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]],ShaderTilemap.prototype=Object.create(Tilemap.prototype),ShaderTilemap.prototype.constructor=ShaderTilemap,PIXI.glCore.VertexArrayObject.FORCE_NATIVE=!0,PIXI.settings.GC_MODE=PIXI.GC_MODES.AUTO,PIXI.tilemap.TileRenderer.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,PIXI.tilemap.TileRenderer.DO_CLEAR=!0,ShaderTilemap.prototype._hackRenderer=function(t){var e=this.animationFrame%4;return 3==e&&(e=1),t.plugins.tilemap.tileAnim[0]=e*this._tileWidth,t.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight,t},ShaderTilemap.prototype.renderCanvas=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderCanvas.call(this,t)},ShaderTilemap.prototype.renderWebGL=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderWebGL.call(this,t)},ShaderTilemap.prototype.refresh=function(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset()),this._needsRepaint=!0},ShaderTilemap.prototype.refreshTileset=function(){var t=this.bitmaps.map(function(t){return t._baseTexture?new PIXI.Texture(t._baseTexture):t});this.lowerLayer.setBitmaps(t),this.upperLayer.setBitmaps(t)},ShaderTilemap.prototype.updateTransform=function(){if(this.roundPixels)var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y);else t=this.origin.x,e=this.origin.y;var i=Math.floor((t-this._margin)/this._tileWidth),r=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,r),(this._needsRepaint||this._lastStartX!==i||this._lastStartY!==r)&&(this._lastStartX=i,this._lastStartY=r,this._paintAllTiles(i,r),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},ShaderTilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=(this._margin,Math.ceil(t/this._tileWidth)+1),r=Math.ceil(e/this._tileHeight)+1;this._layerWidth=i*this._tileWidth,this._layerHeight=r*this._tileHeight;if(this._needsRepaint=!0,!this.lowerZLayer){this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4));var n=PluginManager.parameters("ShaderTilemap"),s=Number(n.hasOwnProperty("squareShader")?n.squareShader:0);this.lowerZLayer.addChild(this.lowerLayer=new PIXI.tilemap.CompositeRectTileLayer(0,[],s)),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[],s))}},ShaderTilemap.prototype._updateLayerPositions=function(t,e){if(this.roundPixels)var i=Math.floor(this.origin.x),r=Math.floor(this.origin.y);else i=this.origin.x,r=this.origin.y;this.lowerZLayer.position.x=t*this._tileWidth-i,this.lowerZLayer.position.y=e*this._tileHeight-r,this.upperZLayer.position.x=t*this._tileWidth-i,this.upperZLayer.position.y=e*this._tileHeight-r},ShaderTilemap.prototype._paintAllTiles=function(t,e){this.lowerZLayer.clear(),this.upperZLayer.clear();for(var i=Math.ceil(this._width/this._tileWidth)+1,r=Math.ceil(this._height/this._tileHeight)+1,n=0;n<r;n++)for(var s=0;s<i;s++)this._paintTiles(t,e,s,n)},ShaderTilemap.prototype._paintTiles=function(t,e,i,r){
var n=t+i,s=e+r,o=i*this._tileWidth,a=r*this._tileHeight,h=this._readMapData(n,s,0),p=this._readMapData(n,s,1),l=this._readMapData(n,s,2),c=this._readMapData(n,s,3),d=this._readMapData(n,s,4),u=this._readMapData(n,s-1,1),_=this.lowerLayer.children[0],f=this.upperLayer.children[0];this._isHigherTile(h)?this._drawTile(f,h,o,a):this._drawTile(_,h,o,a),this._isHigherTile(p)?this._drawTile(f,p,o,a):this._drawTile(_,p,o,a),this._drawShadow(_,d,o,a),this._isTableTile(u)&&!this._isTableTile(p)&&(Tilemap.isShadowingTile(h)||this._drawTableEdge(_,u,o,a)),this._isOverpassPosition(n,s)?(this._drawTile(f,l,o,a),this._drawTile(f,c,o,a)):(this._isHigherTile(l)?this._drawTile(f,l,o,a):this._drawTile(_,l,o,a),this._isHigherTile(c)?this._drawTile(f,c,o,a):this._drawTile(_,c,o,a))},ShaderTilemap.prototype._drawTile=function(t,e,i,r){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,r):this._drawNormalTile(t,e,i,r))},ShaderTilemap.prototype._drawNormalTile=function(t,e,i,r){var n=0;n=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);var s=this._tileWidth,o=this._tileHeight,a=(Math.floor(e/128)%2*8+e%8)*s,h=Math.floor(e%256/8)%16*o;t.addRect(n,a,h,i,r,s,o)},ShaderTilemap.prototype._drawAutotile=function(t,e,i,r){var n=Tilemap.FLOOR_AUTOTILE_TABLE,s=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=s%8,h=Math.floor(s/8),p=0,l=0,c=0,d=!1,u=0,_=0;Tilemap.isTileA1(e)?(c=0,0===s?(u=2,l=0):1===s?(u=2,l=3):2===s?(p=6,l=0):3===s?(p=6,l=3):(p=8*Math.floor(a/4),l=6*h+Math.floor(a/2)%2*3,s%2==0?u=2:(p+=6,n=Tilemap.WATERFALL_AUTOTILE_TABLE,_=1))):Tilemap.isTileA2(e)?(c=1,p=2*a,l=3*(h-2),d=this._isTableTile(e)):Tilemap.isTileA3(e)?(c=2,p=2*a,l=2*(h-6),n=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(c=3,p=2*a,l=Math.floor(2.5*(h-10)+(h%2==1?.5:0)),h%2==1&&(n=Tilemap.WALL_AUTOTILE_TABLE));for(var f=n[o],m=this._tileWidth/2,g=this._tileHeight/2,y=0;y<4;y++){var w=f[y][0],T=f[y][1],v=(2*p+w)*m,b=(2*l+T)*g,S=i+y%2*m,I=r+Math.floor(y/2)*g;if(!d||1!==T&&5!==T)t.addRect(c,v,b,S,I,m,g,u,_);else{var A=w;1===T&&(A=(4-w)%4);var C=(2*p+A)*m,L=(2*l+3)*g;t.addRect(c,C,L,S,I,m,g,u,_),t.addRect(c,v,b,S,I+g/2,m,g/2,u,_)}}},ShaderTilemap.prototype._drawTableEdge=function(t,e,i,r){if(Tilemap.isTileA2(e))for(var n=Tilemap.FLOOR_AUTOTILE_TABLE,s=Tilemap.getAutotileKind(e),o=Tilemap.getAutotileShape(e),a=1,h=2*(s%8),p=3*(Math.floor(s/8)-2),l=n[o],c=this._tileWidth/2,d=this._tileHeight/2,u=0;u<2;u++){var _=(2*h+l[2+u][0])*c,f=(2*p+l[2+u][1])*d+d/2,m=i+u%2*c,g=r+Math.floor(u/2)*d;t.addRect(a,_,f,m,g,c,d/2)}},ShaderTilemap.prototype._drawShadow=function(t,e,i,r){if(15&e)for(var n=this._tileWidth/2,s=this._tileHeight/2,o=0;o<4;o++)if(e&1<<o){var a=i+o%2*n,h=r+Math.floor(o/2)*s;t.addRect(-1,0,0,a,h,n,s)}},TilingSprite.prototype=Object.create(PIXI.extras.PictureTilingSprite.prototype),TilingSprite.prototype.constructor=TilingSprite,TilingSprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.extras.PictureTilingSprite.call(this,e),this._bitmap=null,this._width=0,this._height=0,this._frame=new Rectangle,this.spriteId=Sprite._counter++,this.origin=new Point,this.bitmap=t},TilingSprite.prototype._renderCanvas_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderCanvas,TilingSprite.prototype._renderWebGL_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderWebGL,TilingSprite.prototype._renderCanvas=function(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)},TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this._renderWebGL_PIXI(t))},Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=Rectangle.emptyRectangle)},configurable:!0}),Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),TilingSprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},TilingSprite.prototype.move=function(t,e,i,r){this.x=t||0,this.y=e||0,this._width=i||0,this._height=r||0},TilingSprite.prototype.setFrame=function(t,e,i,r){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=r,this._refresh()},TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.updateTransformTS()},TilingSprite.prototype.updateTransformTS=PIXI.extras.TilingSprite.prototype.updateTransform,TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()},TilingSprite.prototype._refresh=function(){var t=this._frame.clone();0===t.width&&0===t.height&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height),this.texture.frame=t,this.texture._updateID++,this.tilingTexture=null},TilingSprite.prototype._speedUpCustomBlendModes=Sprite.prototype._speedUpCustomBlendModes,TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty()),this._speedUpCustomBlendModes(t),this._renderWebGL_PIXI(t)},ScreenSprite.prototype=Object.create(PIXI.Container.prototype),ScreenSprite.prototype.constructor=ScreenSprite,ScreenSprite.prototype.initialize=function(){PIXI.Container.call(this),this._graphics=new PIXI.Graphics,this.addChild(this._graphics),this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()},Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),ScreenSprite.YEPWarned=!1,ScreenSprite.warnYep=function(){ScreenSprite.YEPWarned||(ScreenSprite.YEPWarned=!0)},Object.defineProperty(ScreenSprite.prototype,"anchor",{get:function(){return ScreenSprite.warnYep(),this.scale.x=1,this.scale.y=1,{x:0,y:0}},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(ScreenSprite.prototype,"blendMode",{get:function(){return this._graphics.blendMode},set:function(t){this._graphics.blendMode=t},configurable:!0}),ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)},ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)},ScreenSprite.prototype.setColor=function(t,e,i){if(this._red!==t||this._green!==e||this._blue!==i){t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=Utils.rgbToCssColor(t,e,i);var r=this._graphics;r.clear();var n=t<<16|e<<8|i;r.beginFill(n,1),r.drawRect(5*-Graphics.width,5*-Graphics.height,10*Graphics.width,10*Graphics.height)}},Window.prototype=Object.create(PIXI.Container.prototype),Window.prototype.constructor=Window,Window.prototype.initialize=function(){PIXI.Container.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1},Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0}),Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(t){this._windowContentsSprite.bitmap=t},configurable:!0}),Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(t){this._windowBackSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0}),Window.prototype.update=function(){this.active&&this._animationCount++,this.children.forEach(function(t){t.update&&t.update()})},Window.prototype.move=function(t,e,i,r){this.x=t||0,this.y=e||0,this._width===i&&this._height===r||(this._width=i||0,this._height=r||0,this._refreshAllParts())},Window.prototype.isOpen=function(){return this._openness>=255},Window.prototype.isClosed=function(){return this._openness<=0},Window.prototype.setCursorRect=function(t,e,i,r){var n=Math.floor(t||0),s=Math.floor(e||0),o=Math.floor(i||0),a=Math.floor(r||0),h=this._cursorRect;h.x===n&&h.y===s&&h.width===o&&h.height===a||(this._cursorRect.x=n,this._cursorRect.y=s,this._cursorRect.width=o,this._cursorRect.height=a,this._refreshCursor())},Window.prototype.setTone=function(t,e,i){var r=this._colorTone;t===r[0]&&e===r[1]&&i===r[2]||(this._colorTone=[t,e,i],this._refreshBack())},Window.prototype.addChildToBack=function(t){var e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)},Window.prototype.updateTransform=function(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),PIXI.Container.prototype.updateTransform.call(this)},Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.Container,this._windowBackSprite=new Sprite,this._windowCursorSprite=new Sprite,this._windowFrameSprite=new Sprite,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.bitmap=new Bitmap(1,1),this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)},Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()},Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()},Window.prototype._refreshBack=function(){var t=this._margin,e=this._width-2*t,i=this._height-2*t,r=new Bitmap(e,i);if(this._windowBackSprite.bitmap=r,this._windowBackSprite.setFrame(0,0,e,i),this._windowBackSprite.move(t,t),e>0&&i>0&&this._windowskin){var n=96;r.blt(this._windowskin,0,0,n,n,0,0,e,i);for(var s=0;s<i;s+=n)for(var o=0;o<e;o+=n)r.blt(this._windowskin,0,n,n,n,o,s,n,n);var a=this._colorTone;r.adjustTone(a[0],a[1],a[2])}},Window.prototype._refreshFrame=function(){var t=this._width,e=this._height,i=24,r=new Bitmap(t,e);if(this._windowFrameSprite.bitmap=r,this._windowFrameSprite.setFrame(0,0,t,e),t>0&&e>0&&this._windowskin){var n=this._windowskin,s=96,o=96;r.blt(n,s+i,0,s-2*i,i,i,0,t-2*i,i),r.blt(n,s+i,0+o-i,s-2*i,i,i,e-i,t-2*i,i),r.blt(n,s+0,0+i,i,s-2*i,0,i,i,e-2*i),r.blt(n,s+o-i,0+i,i,s-2*i,t-i,i,i,e-2*i),r.blt(n,s+0,0,i,i,0,0,i,i),r.blt(n,s+o-i,0,i,i,t-i,0,i,i),r.blt(n,s+0,0+o-i,i,i,0,e-i,i,i),r.blt(n,s+o-i,0+o-i,i,i,t-i,e-i,i,i)}},Window.prototype._refreshCursor=function(){var t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,r=this._cursorRect.width,n=this._cursorRect.height,s=4,o=Math.max(e,t),a=Math.max(i,t),h=e-o,p=i-a,l=Math.min(r,this._width-t-o),c=Math.min(n,this._height-t-a),d=new Bitmap(l,c);if(this._windowCursorSprite.bitmap=d,this._windowCursorSprite.setFrame(0,0,l,c),this._windowCursorSprite.move(o,a),r>0&&n>0&&this._windowskin){var u=this._windowskin,_=96,f=48;d.blt(u,_+s,_+s,f-2*s,f-2*s,h+s,p+s,r-2*s,n-2*s),d.blt(u,_+s,_+0,f-2*s,s,h+s,p+0,r-2*s,s),d.blt(u,_+s,_+f-s,f-2*s,s,h+s,p+n-s,r-2*s,s),d.blt(u,_+0,_+s,s,f-2*s,h+0,p+s,s,n-2*s),d.blt(u,_+f-s,_+s,s,f-2*s,h+r-s,p+s,s,n-2*s),d.blt(u,_+0,_+0,s,s,h+0,p+0,s,s),d.blt(u,_+f-s,_+0,s,s,h+r-s,p+0,s,s),d.blt(u,_+0,_+f-s,s,s,h+0,p+n-s,s,s),d.blt(u,_+f-s,_+f-s,s,s,h+r-s,p+n-s,s,s)}},Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)},Window.prototype._refreshArrows=function(){var t=this._width,e=this._height,i=24,r=i/2,n=96+i,s=0+i;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(n+r,s+r+i,i,r),this._downArrowSprite.move(t/2,e-r),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(n+r,s,i,r),this._upArrowSprite.move(t/2,r)},Window.prototype._refreshPauseSign=function(){var t=144,e=96,i=24;this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(t,e,i,i),this._windowPauseSignSprite.alpha=0},Window.prototype._updateCursor=function(){var t=this._animationCount%40,e=this.contentsOpacity;this.active&&(e-=t<20?8*t:8*(40-t)),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()},Window.prototype._updateContents=function(){var t=this._width-2*this._padding,e=this._height-2*this._padding;t>0&&e>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1},Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible},Window.prototype._updatePauseSign=function(){var t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2,r=144,n=96,s=24;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(r+e*s,n+i*s,s,s),t.visible=this.isOpen()},WindowLayer.prototype=Object.create(PIXI.Container.prototype),WindowLayer.prototype.constructor=WindowLayer,WindowLayer.prototype.initialize=function(){PIXI.Container.call(this),this._width=0,this._height=0,this._tempCanvas=null,this._translationMatrix=[1,0,0,0,1,0,0,0,1],this._windowMask=new PIXI.Graphics,this._windowMask.beginFill(16777215,1),this._windowMask.drawRect(0,0,0,0),this._windowMask.endFill(),this._windowRect=this._windowMask.graphicsData[0].shape,this._renderSprite=null,this.filterArea=new PIXI.Rectangle,this.filters=[WindowLayer.voidFilter],this.on("removed",this.onRemoveAsAChild)},WindowLayer.prototype.onRemoveAsAChild=function(){this.removeChildren()},WindowLayer.voidFilter=new PIXI.filters.VoidFilter,Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},configurable:!0}),Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},configurable:!0}),WindowLayer.prototype.move=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},WindowLayer.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},WindowLayer.prototype.renderCanvas=function(t){if(this.visible&&this.renderable){this._tempCanvas||(this._tempCanvas=document.createElement("canvas")),this._tempCanvas.width=Graphics.width,this._tempCanvas.height=Graphics.height;var e=t.context,i=this._tempCanvas.getContext("2d");i.save(),i.clearRect(0,0,Graphics.width,Graphics.height),i.beginPath(),i.rect(this.x,this.y,this.width,this.height),i.closePath(),i.clip(),t.context=i;for(var r=0;r<this.children.length;r++){var n=this.children[r];n._isWindow&&n.visible&&n.openness>0&&(this._canvasClearWindowRect(t,n),i.save(),n.renderCanvas(t),i.restore())}i.restore(),t.context=e,t.context.setTransform(1,0,0,1,0,0),t.context.globalCompositeOperation="source-over",t.context.globalAlpha=1,t.context.drawImage(this._tempCanvas,0,0);for(var s=0;s<this.children.length;s++)this.children[s]._isWindow||this.children[s].renderCanvas(t)}},WindowLayer.prototype._canvasClearWindowRect=function(t,e){var i=this.x+e.x,r=this.y+e.y+e.height/2*(1-e._openness/255),n=e.width,s=e.height*e._openness/255;t.context.clearRect(i,r,n,s)},WindowLayer.prototype.renderWebGL=function(t){if(this.visible&&this.renderable&&0!=this.children.length){t.flush(),this.filterArea.copy(this),t.filterManager.pushFilter(this,this.filters),t.currentRenderer.start();var e=new PIXI.Point,i=t._activeRenderTarget,r=i.projectionMatrix;e.x=Math.round((r.tx+1)/2*i.sourceFrame.width),e.y=Math.round((r.ty+1)/2*i.sourceFrame.height);for(var n=0;n<this.children.length;n++){var s=this.children[n];s._isWindow&&s.visible&&s.openness>0&&(this._maskWindow(s,e),t.maskManager.pushScissorMask(this,this._windowMask),t.clear(),t.maskManager.popScissorMask(),t.currentRenderer.start(),s.renderWebGL(t),t.currentRenderer.flush())}t.flush(),t.filterManager.popFilter(),t.maskManager.popScissorMask();for(var o=0;o<this.children.length;o++)this.children[o]._isWindow||this.children[o].renderWebGL(t)}},WindowLayer.prototype._maskWindow=function(t,e){this._windowMask._currentBounds=null,this._windowMask.boundsDirty=!0;var i=this._windowRect;i.x=this.x+e.x+t.x,i.y=this.x+e.y+t.y+t.height/2*(1-t._openness/255),i.width=t.width,i.height=t.height*t._openness/255},Weather.prototype=Object.create(PIXI.Container.prototype),Weather.prototype.constructor=Weather,Weather.prototype.initialize=function(){PIXI.Container.call(this),this._width=Graphics.width,this._height=Graphics.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point},Weather.prototype.update=function(){this._updateDimmer(),this._updateAllSprites()},Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")},Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)},Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)},Weather.prototype._updateAllSprites=function(){for(var t=Math.floor(10*this.power);this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach(function(t){this._updateSprite(t),t.x=t.ax-this.origin.x,t.y=t.ay-this.origin.y},this)},Weather.prototype._addSprite=function(){var t=new Sprite(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)},Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())},Weather.prototype._updateSprite=function(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t)}t.opacity<40&&this._rebornSprite(t)},Weather.prototype._updateRainSprite=function(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6},Weather.prototype._updateStormSprite=function(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8},Weather.prototype._updateSnowSprite=function(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3},Weather.prototype._rebornSprite=function(t){t.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x,t.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)},ToneFilter.prototype=Object.create(PIXI.filters.ColorMatrixFilter.prototype),ToneFilter.prototype.constructor=ToneFilter,ToneFilter.prototype.adjustHue=function(t){this.hue(t,!0)},ToneFilter.prototype.adjustSaturation=function(t){t=(t||0).clamp(-255,255)/255,this.saturate(t,!0)},ToneFilter.prototype.adjustTone=function(t,e,i){if(t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,0!==t||0!==e||0!==i){var r=[1,0,0,t,0,0,1,0,e,0,0,0,1,i,0,0,0,0,1,0];this._loadMatrix(r,!0)}},ToneSprite.prototype=Object.create(PIXI.Container.prototype),ToneSprite.prototype.constructor=ToneSprite,ToneSprite.prototype.initialize=function(){PIXI.Container.call(this),this.clear()},ToneSprite.prototype.clear=function(){this._red=0,this._green=0,this._blue=0,this._gray=0},ToneSprite.prototype.setTone=function(t,e,i,r){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(r||0).clamp(0,255)},ToneSprite.prototype._renderCanvas=function(t){if(this.visible){var e=t.context,i=this.worldTransform,r=t.resolution,n=Graphics.width,s=Graphics.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*r,i.ty*r),Graphics.canUseSaturationBlend()&&this._gray>0&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,n,s)),e.globalAlpha=1;var o=Math.max(0,this._red),a=Math.max(0,this._green),h=Math.max(0,this._blue);if((o||a||h)&&(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(o,a,h),e.fillRect(0,0,n,s)),Graphics.canUseDifferenceBlend()){var p=Math.max(0,-this._red),l=Math.max(0,-this._green),c=Math.max(0,-this._blue);(p||l||c)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,n,s),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(p,l,c),e.fillRect(0,0,n,s),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,n,s))}e.restore()}},ToneSprite.prototype._renderWebGL=function(){},Stage.prototype=Object.create(PIXI.Container.prototype),Stage.prototype.constructor=Stage,Stage.prototype.initialize=function(){PIXI.Container.call(this),this.interactive=!1},WebAudio._standAlone=function(t){return!t.ResourceHandler}(this),WebAudio.prototype.initialize=function(t){WebAudio._initialized||WebAudio.initialize(),this.clear(),WebAudio._standAlone||(this._loader=ResourceHandler.createLoader(t,this._load.bind(this,t),function(){this._hasError=!0}.bind(this))),this._load(t),this._url=t},WebAudio._masterVolume=1,WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1,WebAudio.initialize=function(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context},WebAudio.canPlayOgg=function(){return this._initialized||this.initialize(),!!this._canPlayOgg},WebAudio.canPlayM4a=function(){return this._initialized||this.initialize(),!!this._canPlayM4a},WebAudio.setMasterVolume=function(t){this._masterVolume=t,this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)},WebAudio._createContext=function(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(t){this._context=null}},WebAudio._detectCodecs=function(){var t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType("audio/ogg"),this._canPlayM4a=t.canPlayType("audio/mp4"))},WebAudio._createMasterGainNode=function(){var t=WebAudio._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,t.currentTime),this._masterGainNode.connect(t.destination))},WebAudio._setupEventHandlers=function(){var t=function(){var t=WebAudio._context;t&&"suspended"===t.state&&"function"==typeof t.resume?t.resume().then(function(){WebAudio._onTouchStart()}):WebAudio._onTouchStart()};document.addEventListener("keydown",t),document.addEventListener("mousedown",t),document.addEventListener("touchend",t),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))},WebAudio._onTouchStart=function(){var t=WebAudio._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)},WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)},WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)},WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()},WebAudio._fadeIn=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._masterVolume,i+t)}},WebAudio._fadeOut=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._masterVolume,i),e.linearRampToValueAtTime(0,i+t)}},WebAudio.prototype.clear=function(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1},Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,WebAudio._context.currentTime)},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._updatePanner()},configurable:!0}),WebAudio.prototype.isReady=function(){return!!this._buffer},WebAudio.prototype.isError=function(){return this._hasError},WebAudio.prototype.isPlaying=function(){return!!this._sourceNode},WebAudio.prototype.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(t,e)}.bind(this)))},WebAudio.prototype.stop=function(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;){this._stopListeners.shift()()}},WebAudio.prototype.fadeIn=function(t){if(this.isReady()){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},WebAudio.prototype.fadeOut=function(t){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._volume,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1},WebAudio.prototype.seek=function(){if(WebAudio._context){var t=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}return 0},WebAudio.prototype.addLoadListener=function(t){this._loadListeners.push(t)},WebAudio.prototype.addStopListener=function(t){this._stopListeners.push(t)},WebAudio.prototype._load=function(t){if(WebAudio._context){var e=new XMLHttpRequest;Decrypter.hasEncryptedAudio&&(t=Decrypter.extToEncryptExt(t)),e.open("GET",t),e.responseType="arraybuffer",e.onload=function(){e.status<400&&this._onXhrLoad(e)}.bind(this),e.onerror=this._loader||function(){this._hasError=!0}.bind(this),e.send()}},WebAudio.prototype._onXhrLoad=function(t){var e=t.response;Decrypter.hasEncryptedAudio&&(e=Decrypter.decryptArrayBuffer(e)),this._readLoopComments(new Uint8Array(e)),WebAudio._context.decodeAudioData(e,function(t){this._buffer=t,this._totalTime=t.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}.bind(this))},WebAudio.prototype._startPlaying=function(t,e){if(this._loopLength>0)for(;e>=this._loopStart+this._loopLength;)e-=this._loopLength;this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=WebAudio._context.currentTime-e/this._pitch,this._createEndTimer()},WebAudio.prototype._createNodes=function(){var t=WebAudio._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.setValueAtTime(this._pitch,t.currentTime),this._gainNode=t.createGain(),this._gainNode.gain.setValueAtTime(this._volume,t.currentTime),this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()},WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)},WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)},WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var t=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1e3*t)}},WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)},WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var t=this._pan,e=1-Math.abs(t);this._pannerNode.setPosition(t,0,e)}},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()()}},WebAudio.prototype._readLoopComments=function(t){this._readOgg(t),this._readMp4(t)},WebAudio.prototype._readOgg=function(t){for(var e=0;e<t.length&&"OggS"===this._readFourCharacters(t,e);){e+=26;for(var i=!1,r=t[e++],n=[],s=0;s<r;s++)n.push(t[e++]);for(s=0;s<r;s++){if("vorb"===this._readFourCharacters(t,e+1)){var o=t[e];1===o?this._sampleRate=this._readLittleEndian(t,e+12):3===o&&this._readMetaData(t,e,n[s]),i=!0}e+=n[s]}if(!i)break}},WebAudio.prototype._readMp4=function(t){if("ftyp"===this._readFourCharacters(t,4))for(var e=0;e<t.length;){var i=this._readBigEndian(t,e),r=this._readFourCharacters(t,e+4);if("moov"===r)e+=8;else if("mvhd"===r&&(this._sampleRate=this._readBigEndian(t,e+20)),"udta"!==r&&"meta"!==r||this._readMetaData(t,e,i),e+=i,i<=1)break}},WebAudio.prototype._readMetaData=function(t,e,i){for(var r=e;r<e+i-10;r++)if("LOOP"===this._readFourCharacters(t,r)){for(var n="";t[r]>0;)n+=String.fromCharCode(t[r++]);if(n.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),n.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==n||"LOOPLENGTH"==n){var s="";for(r+=16;t[r]>0;)s+=String.fromCharCode(t[r++]);"LOOPSTART"==n?this._loopStart=parseInt(s):this._loopLength=parseInt(s)}}},WebAudio.prototype._readLittleEndian=function(t,e){return 16777216*t[e+3]+65536*t[e+2]+256*t[e+1]+t[e+0]},
WebAudio.prototype._readBigEndian=function(t,e){return 16777216*t[e+0]+65536*t[e+1]+256*t[e+2]+t[e+3]},WebAudio.prototype._readFourCharacters=function(t,e){for(var i="",r=0;r<4;r++)i+=String.fromCharCode(t[e+r]);return i},Html5Audio._initialized=!1,Html5Audio._unlocked=!1,Html5Audio._audioElement=null,Html5Audio._gainTweenInterval=null,Html5Audio._tweenGain=0,Html5Audio._tweenTargetGain=0,Html5Audio._tweenGainStep=0,Html5Audio._staticSePath=null,Html5Audio.setup=function(t){this._initialized||this.initialize(),this.clear(),Decrypter.hasEncryptedAudio&&this._audioElement.src&&window.URL.revokeObjectURL(this._audioElement.src),this._url=t},Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(t){this._audioElement=null}this._audioElement&&this._setupEventHandlers(),this._initialized=!0}return!!this._audioElement},Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this)),this._audioElement.addEventListener("error",this._onError.bind(this)),this._audioElement.addEventListener("ended",this._onEnded.bind(this))},Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))},Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},Html5Audio._onLoadedData=function(){this._buffered=!0,this._unlocked&&this._onLoad()},Html5Audio._onError=function(){this._hasError=!0},Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()},Html5Audio._onHide=function(){this._audioElement.volume=0,this._tweenGain=0},Html5Audio._onShow=function(){this.fadeIn(.5)},Html5Audio.clear=function(){this.stop(),this._volume=1,this._loadListeners=[],this._hasError=!1,this._autoPlay=!1,this._isLoading=!1,this._buffered=!1},Html5Audio.setStaticSe=function(t){this._initialized||(this.initialize(),this.clear()),this._staticSePath=t},Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0}),Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(t){Html5Audio._volume=t,Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0}),Html5Audio.isReady=function(){return this._buffered},Html5Audio.isError=function(){return this._hasError},Html5Audio.isPlaying=function(){return!this._audioElement.paused},Html5Audio.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(t,e),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))},Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause(),this._autoPlay=!1,this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)},Html5Audio.fadeIn=function(t){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(t)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},Html5Audio.fadeOut=function(t){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(t))},Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0},Html5Audio.addLoadListener=function(t){this._loadListeners.push(t)},Html5Audio._load=function(t){this._audioElement&&(this._isLoading=!0,this._audioElement.src=t,this._audioElement.load())},Html5Audio._startPlaying=function(t,e){this._audioElement.loop=t,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=e,this._audioElement.play())},Html5Audio._onLoad=function(){for(this._isLoading=!1;this._loadListeners.length>0;){this._loadListeners.shift()()}},Html5Audio._startGainTween=function(t){this._audioElement.volume=this._tweenGain,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*t),this._gainTweenInterval=setInterval(function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)},1e3/60)},Html5Audio._applyTweenValue=function(t){Html5Audio._tweenGain+=Html5Audio._tweenGainStep,Html5Audio._tweenGain<0&&Html5Audio._tweenGainStep<0?Html5Audio._tweenGain=0:Html5Audio._tweenGain>t&&Html5Audio._tweenGainStep>0&&(Html5Audio._tweenGain=t),Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)<.01&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null),Html5Audio._audioElement.volume=Html5Audio._tweenGain},JsonEx.maxDepth=100,JsonEx._id=1,JsonEx._generateId=function(){return JsonEx._id++},JsonEx.stringify=function(t){var e=[];JsonEx._id=1;var i=JSON.stringify(this._encode(t,e,0));return this._cleanMetadata(t),this._restoreCircularReference(e),i},JsonEx._restoreCircularReference=function(t){t.forEach(function(t){var e=t[0],i=t[1],r=t[2];i[e]=r})},JsonEx.parse=function(t){var e=[],i={},r=this._decode(JSON.parse(t),e,i);return this._cleanMetadata(r),this._linkCircularReference(r,e,i),r},JsonEx._linkCircularReference=function(t,e,i){e.forEach(function(t){var e=t[0],r=t[1],n=t[2];r[e]=i[n]})},JsonEx._cleanMetadata=function(t){t&&(delete t["@"],delete t["@c"],"object"==typeof t&&Object.keys(t).forEach(function(e){var i=t[e];"object"==typeof i&&JsonEx._cleanMetadata(i)}))},JsonEx.makeDeepCopy=function(t){return this.parse(this.stringify(t))},JsonEx._encode=function(t,e,i){if(i=i||0,++i>=this.maxDepth)throw new Error("Object too deep");var r=Object.prototype.toString.call(t);if("[object Object]"===r||"[object Array]"===r){t["@c"]=JsonEx._generateId();var n=this._getConstructorName(t);for(var s in"Object"!==n&&"Array"!==n&&(t["@"]=n),t)t.hasOwnProperty(s)&&!s.match(/^@./)&&(t[s]&&"object"==typeof t[s]?t[s]["@c"]?(e.push([s,t,t[s]]),t[s]={"@r":t[s]["@c"]}):(t[s]=this._encode(t[s],e,i+1),t[s]instanceof Array&&(e.push([s,t,t[s]]),t[s]={"@c":t[s]["@c"],"@a":t[s]})):t[s]=this._encode(t[s],e,i+1))}return i--,t},JsonEx._decode=function(t,e,i){var r=Object.prototype.toString.call(t);if("[object Object]"===r||"[object Array]"===r){if(i[t["@c"]]=t,t["@"]){var n=window[t["@"]];n&&(t=this._resetPrototype(t,n.prototype))}for(var s in t)if(t.hasOwnProperty(s)){if(t[s]&&t[s]["@a"]){var o=t[s]["@a"];o["@c"]=t[s]["@c"],t[s]=o}t[s]&&t[s]["@r"]&&e.push([s,t,t[s]["@r"]]),t[s]=this._decode(t[s],e,i)}}return t},JsonEx._getConstructorName=function(t){var e=t.constructor.name;void 0===e&&(e=/^\s*function\s*([A-Za-z0-9_$]*)/.exec(t.constructor)[1]);return e},JsonEx._resetPrototype=function(t,e){if(void 0!==Object.setPrototypeOf)Object.setPrototypeOf(t,e);else if("__proto__"in t)t.__proto__=e;else{var i=Object.create(e);for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);t=i}return t},Decrypter.hasEncryptedImages=!1,Decrypter.hasEncryptedAudio=!1,Decrypter._requestImgFile=[],Decrypter._headerlength=16,Decrypter._xhrOk=400,Decrypter._encryptionKey="",Decrypter._ignoreList=["img/system/Window.png"],Decrypter.SIGNATURE="5250474d56000000",Decrypter.VER="000301",Decrypter.REMAIN="0000000000",Decrypter.checkImgIgnore=function(t){for(var e=0;e<this._ignoreList.length;e++)if(t===this._ignoreList[e])return!0;return!1},Decrypter.decryptImg=function(t,e){t=this.extToEncryptExt(t);var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.send(),i.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(i.response);e._image.src=Decrypter.createBlobUrl(t),e._image.addEventListener("load",e._loadListener=Bitmap.prototype._onLoad.bind(e)),e._image.addEventListener("error",e._errorListener=e._loader||Bitmap.prototype._onError.bind(e))}},i.onerror=function(){e._loader?e._loader():e._onError()}},Decrypter.decryptHTML5Audio=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="arraybuffer",r.send(),r.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(r.response),n=Decrypter.createBlobUrl(t);AudioManager.createDecryptBuffer(n,e,i)}}},Decrypter.cutArrayHeader=function(t,e){return t.slice(e)},Decrypter.decryptArrayBuffer=function(t){if(!t)return null;var e,i=new Uint8Array(t,0,this._headerlength),r=this.SIGNATURE+this.VER+this.REMAIN,n=new Uint8Array(16);for(e=0;e<this._headerlength;e++)n[e]=parseInt("0x"+r.substr(2*e,2),16);for(e=0;e<this._headerlength;e++)if(i[e]!==n[e])throw new Error("Header is wrong");t=this.cutArrayHeader(t,Decrypter._headerlength);var s=new DataView(t);if(this.readEncryptionkey(),t){var o=new Uint8Array(t);for(e=0;e<this._headerlength;e++)o[e]=o[e]^parseInt(Decrypter._encryptionKey[e],16),s.setUint8(e,o[e])}return t},Decrypter.createBlobUrl=function(t){var e=new Blob([t]);return window.URL.createObjectURL(e)},Decrypter.extToEncryptExt=function(t){var e=t.split(".").pop(),i=e;return i="ogg"===e?".rpgmvo":"m4a"===e?".rpgmvm":"png"===e?".rpgmvp":e,t.slice(0,t.lastIndexOf(e)-1)+i},Decrypter.readEncryptionkey=function(){this._encryptionKey=$dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean)},ResourceHandler._reloaders=[],ResourceHandler._defaultRetryInterval=[500,1e3,3e3],ResourceHandler.createLoader=function(t,e,i,r){r=r||this._defaultRetryInterval;var n=this._reloaders,s=0;return function(){s<r.length?(setTimeout(e,r[s]),s++):(i&&i(),t&&(0===n.length&&(Graphics.printLoadingError(t),SceneManager.stop()),n.push(function(){s=0,e()})))}},ResourceHandler.exists=function(){return this._reloaders.length>0},ResourceHandler.retry=function(){this._reloaders.length>0&&(Graphics.eraseLoadingError(),SceneManager.resume(),this._reloaders.forEach(function(t){t()}),this._reloaders.length=0)};